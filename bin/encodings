#!/usr/bin/env ruby
# frozen_string_literal: true

def table(range, encoding)
  puts "//  #{(0...16).map { |value| value.to_s(16).upcase }.join("      ")}"

  range.each_slice(16).with_index do |slice, row_index|
    row =
      slice.map do |codepoint|
        character = codepoint.chr(encoding)

        value = 0
        value |= (1 << 0) if character.match?(/[[:alpha:]]/)
        value |= (1 << 1) if character.match?(/[[:alnum:]]/)
        value |= (1 << 2) if character.match?(/[[:upper:]]/)

        "0b%03b," % value
      end

    puts "#{row.join(" ")} // #{row_index.to_s(16).upcase}x"
  end
end

def lists(name, range, encoding)
  range = range.map { begin; _1.chr(encoding); _1; rescue RangeError; nil; end }.compact

  { alpha: /[[:alpha:]]/, alnum: /[[:alnum:]]/, isupper: /[[:upper:]]/ }.map do |kind, regex|
    codepoints = range.select { _1.chr(encoding).match?(regex) }

    previous = nil
    groups =
      codepoints.slice_before do |codepoint|
        (!previous.nil? && (codepoint - previous) != 1).tap { previous = codepoint }
      end

    matched =
      groups.flat_map do |group|
        ["0x#{group.first.to_s(16).upcase}", "0x#{group.last.to_s(16).upcase}"]
      end

    puts "\n#define #{name.upcase}_#{kind.upcase}_CODEPOINTS_LENGTH #{matched.length}"
    puts "#{name}_codepoint_t #{name}_#{kind}_codepoints[#{name.upcase}_#{kind.upcase}_CODEPOINTS_LENGTH] = {"
    matched.each_slice(2) { |slice| puts "  #{slice.join(", ")}," }
    puts "};"
  end
end

puts "ASCII"
puts "=========="
table((0...128), Encoding::US_ASCII)

puts "\nISO-8859-1"
puts "=========="
table((0...256), Encoding::ISO8859_1)

puts "\nISO-8859-2"
puts "=========="
table((0...256), Encoding::ISO8859_2)

puts "\nISO-8859-3"
puts "=========="
table((0...256), Encoding::ISO8859_3)

puts "\nISO-8859-4"
puts "=========="
table((0...256), Encoding::ISO8859_4)

puts "\nISO-8859-5"
puts "=========="
table((0...256), Encoding::ISO8859_5)

puts "\nISO-8859-6"
puts "=========="
table((0...256), Encoding::ISO8859_6)

puts "\nISO-8859-7"
puts "=========="
table((0...256), Encoding::ISO8859_7)

puts "\nISO-8859-8"
puts "=========="
table((0...256), Encoding::ISO8859_8)

puts "\nISO-8859-9"
puts "=========="
table((0...256), Encoding::ISO8859_9)

puts "\nISO-8859-10"
puts "=========="
table((0...256), Encoding::ISO8859_10)

puts "\nISO-8859-11"
puts "=========="
table((0...256), Encoding::ISO8859_11)

puts "\nISO-8859-13"
puts "=========="
table((0...256), Encoding::ISO8859_13)

puts "\nISO-8859-14"
puts "=========="
table((0...256), Encoding::ISO8859_14)

puts "\nISO-8859-15"
puts "=========="
table((0...256), Encoding::ISO8859_15)

puts "\nISO-8859-16"
puts "=========="
table((0...256), Encoding::ISO8859_16)

puts "\nWindows-1251"
puts "=========="
table((0...256), Encoding::Windows_1251)

puts "\nWindows-1252"
puts "=========="
table((0...256), Encoding::Windows_1252)

puts "\nBig5"
puts "=========="
lists("big5", (0...0x10000), Encoding::Big5)

puts "\nUTF-8"
puts "=========="
lists("utf8", (0...0x110000), Encoding::UTF_8)

puts "\nShift-JIS"
puts "=========="
lists("shift_jis", (0...0x10000), Encoding::Shift_JIS)

puts "\nEUC-JP"
puts "=========="
lists("euc-jp", (0...0x10000), Encoding::EUC_JP)

puts "\nWindows-31J"
puts "=========="
lists("windows-31j", (0...0x10000), Encoding::Windows_31J)
